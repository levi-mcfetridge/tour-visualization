This is where the main magic happens